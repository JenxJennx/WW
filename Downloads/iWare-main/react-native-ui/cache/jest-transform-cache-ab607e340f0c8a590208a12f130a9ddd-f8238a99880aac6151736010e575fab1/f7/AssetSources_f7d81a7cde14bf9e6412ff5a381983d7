fed81e46a86880b39d868546af676bda
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.resolveUri = resolveUri;
exports.selectAssetSource = selectAssetSource;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _expoModulesCore = require("expo-modules-core");

var _pathBrowserify = _interopRequireDefault(require("path-browserify"));

var _reactNative = require("react-native");

var _urlParse = _interopRequireDefault(require("url-parse"));

var _AssetSourceResolver = _interopRequireDefault(require("./AssetSourceResolver"));

var _PlatformUtils = require("./PlatformUtils");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

var assetMapOverride = (0, _PlatformUtils.getManifest)().assetMapOverride;

function selectAssetSource(meta) {
  var _manifest2$extra, _manifest2$extra$expo;

  if (assetMapOverride && assetMapOverride.hasOwnProperty(meta.hash)) {
    meta = _objectSpread(_objectSpread({}, meta), assetMapOverride[meta.hash]);
  }

  var scale = _AssetSourceResolver.default.pickScale(meta.scales, _reactNative.PixelRatio.get());

  var index = meta.scales.findIndex(function (s) {
    return s === scale;
  });
  var hash = meta.fileHashes ? meta.fileHashes[index] || meta.fileHashes[0] : meta.hash;
  var uri = meta.fileUris ? meta.fileUris[index] || meta.fileUris[0] : meta.uri;

  if (uri) {
    return {
      uri: resolveUri(uri),
      hash: hash
    };
  }

  var assetUrlOverride = (0, _PlatformUtils.getManifest)().assetUrlOverride;

  if (assetUrlOverride) {
    var _uri = _pathBrowserify.default.join(assetUrlOverride, hash);

    return {
      uri: resolveUri(_uri),
      hash: hash
    };
  }

  var fileScale = scale === 1 ? '' : "@" + scale + "x";
  var fileExtension = meta.type ? "." + encodeURIComponent(meta.type) : '';
  var suffix = "/" + encodeURIComponent(meta.name) + fileScale + fileExtension + "?platform=" + encodeURIComponent(_expoModulesCore.Platform.OS) + "&hash=" + encodeURIComponent(meta.hash);

  if (/^https?:\/\//.test(meta.httpServerLocation)) {
    var _uri2 = meta.httpServerLocation + suffix;

    return {
      uri: _uri2,
      hash: hash
    };
  }

  var manifest2 = (0, _PlatformUtils.getManifest2)();

  if (manifest2 != null && (_manifest2$extra = manifest2.extra) != null && (_manifest2$extra$expo = _manifest2$extra.expoGo) != null && _manifest2$extra$expo.developer) {
    var baseUrl = new _urlParse.default("http://" + manifest2.extra.expoGo.debuggerHost);
    baseUrl.set('pathname', meta.httpServerLocation + suffix);
    return {
      uri: baseUrl.href,
      hash: hash
    };
  }

  if ((0, _PlatformUtils.getManifest)().developer) {
    var _baseUrl = new _urlParse.default((0, _PlatformUtils.getManifest)().bundleUrl);

    _baseUrl.set('pathname', meta.httpServerLocation + suffix);

    return {
      uri: _baseUrl.href,
      hash: hash
    };
  }

  return {
    uri: "https://classic-assets.eascdn.net/~assets/" + encodeURIComponent(hash),
    hash: hash
  };
}

function resolveUri(uri) {
  if (!_PlatformUtils.manifestBaseUrl) {
    return uri;
  }

  var _URL = new _urlParse.default(uri),
      protocol = _URL.protocol;

  if (protocol !== '') {
    return uri;
  }

  var baseUrl = new _urlParse.default(_PlatformUtils.manifestBaseUrl);
  var resolvedPath = uri.startsWith('/') ? uri : _pathBrowserify.default.join(baseUrl.pathname, uri);
  baseUrl.set('pathname', resolvedPath);
  return baseUrl.href;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU8sQ0FBQ0csR0FBUixDQUFZLFVBQVosRUFBd0JLLFlBQXhCO0VBQ0EsT0FBT1IsT0FBTyxDQUFDSSxJQUFmO0FBQ0QiLCJuYW1lcyI6WyJhc3NldE1hcE92ZXJyaWRlIiwic2VsZWN0QXNzZXRTb3VyY2UiLCJtZXRhIiwiaGFzT3duUHJvcGVydHkiLCJoYXNoIiwic2NhbGUiLCJBc3NldFNvdXJjZVJlc29sdmVyIiwicGlja1NjYWxlIiwic2NhbGVzIiwiUGl4ZWxSYXRpbyIsImdldCIsImluZGV4IiwiZmluZEluZGV4IiwicyIsImZpbGVIYXNoZXMiLCJ1cmkiLCJmaWxlVXJpcyIsInJlc29sdmVVcmkiLCJhc3NldFVybE92ZXJyaWRlIiwicGF0aCIsImpvaW4iLCJmaWxlU2NhbGUiLCJmaWxlRXh0ZW5zaW9uIiwidHlwZSIsImVuY29kZVVSSUNvbXBvbmVudCIsInN1ZmZpeCIsIm5hbWUiLCJQbGF0Zm9ybSIsIk9TIiwidGVzdCIsImh0dHBTZXJ2ZXJMb2NhdGlvbiIsIm1hbmlmZXN0MiIsImV4dHJhIiwiZXhwb0dvIiwiZGV2ZWxvcGVyIiwiYmFzZVVybCIsIlVSTCIsImRlYnVnZ2VySG9zdCIsInNldCIsImhyZWYiLCJidW5kbGVVcmwiLCJtYW5pZmVzdEJhc2VVcmwiLCJwcm90b2NvbCIsInJlc29sdmVkUGF0aCIsInN0YXJ0c1dpdGgiLCJwYXRobmFtZSJdLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvQXNzZXRTb3VyY2VzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBsYXRmb3JtIH0gZnJvbSAnZXhwby1tb2R1bGVzLWNvcmUnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aC1icm93c2VyaWZ5JztcbmltcG9ydCB7IFBpeGVsUmF0aW8gfSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuaW1wb3J0IFVSTCBmcm9tICd1cmwtcGFyc2UnO1xuXG5pbXBvcnQgQXNzZXRTb3VyY2VSZXNvbHZlciBmcm9tICcuL0Fzc2V0U291cmNlUmVzb2x2ZXInO1xuaW1wb3J0IHsgbWFuaWZlc3RCYXNlVXJsLCBnZXRNYW5pZmVzdCwgZ2V0TWFuaWZlc3QyIH0gZnJvbSAnLi9QbGF0Zm9ybVV0aWxzJztcblxuLy8gQGRvY3NNaXNzaW5nXG5leHBvcnQgdHlwZSBBc3NldE1ldGFkYXRhID0ge1xuICBoYXNoOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgdHlwZTogc3RyaW5nO1xuICB3aWR0aD86IG51bWJlcjtcbiAgaGVpZ2h0PzogbnVtYmVyO1xuICBzY2FsZXM6IG51bWJlcltdO1xuICBodHRwU2VydmVyTG9jYXRpb246IHN0cmluZztcbiAgdXJpPzogc3RyaW5nO1xuICBmaWxlSGFzaGVzPzogc3RyaW5nW107XG4gIGZpbGVVcmlzPzogc3RyaW5nW107XG59O1xuXG5leHBvcnQgdHlwZSBBc3NldFNvdXJjZSA9IHtcbiAgdXJpOiBzdHJpbmc7XG4gIGhhc2g6IHN0cmluZztcbn07XG5cbi8vIEZhc3QgbG9va3VwIGNoZWNrIGlmIGFzc2V0IG1hcCBoYXMgYW55IG92ZXJyaWRlcyBpbiB0aGUgbWFuaWZlc3RcbmNvbnN0IGFzc2V0TWFwT3ZlcnJpZGUgPSBnZXRNYW5pZmVzdCgpLmFzc2V0TWFwT3ZlcnJpZGU7XG5cbi8qKlxuICogU2VsZWN0cyB0aGUgYmVzdCBmaWxlIGZvciB0aGUgZ2l2ZW4gYXNzZXQgKGV4OiBjaG9vc2luZyB0aGUgYmVzdCBzY2FsZSBmb3IgaW1hZ2VzKSBhbmQgcmV0dXJuc1xuICogYSB7IHVyaSwgaGFzaCB9IHBhaXIgZm9yIHRoZSBzcGVjaWZpYyBhc3NldCBmaWxlLlxuICpcbiAqIElmIHRoZSBhc3NldCBpc24ndCBhbiBpbWFnZSB3aXRoIG11bHRpcGxlIHNjYWxlcywgdGhlIGZpcnN0IGZpbGUgaXMgc2VsZWN0ZWQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZWxlY3RBc3NldFNvdXJjZShtZXRhOiBBc3NldE1ldGFkYXRhKTogQXNzZXRTb3VyY2Uge1xuICAvLyBPdmVycmlkZSB3aXRoIHRoZSBhc3NldCBtYXAgaW4gbWFuaWZlc3QgaWYgYXZhaWxhYmxlXG4gIGlmIChhc3NldE1hcE92ZXJyaWRlICYmIGFzc2V0TWFwT3ZlcnJpZGUuaGFzT3duUHJvcGVydHkobWV0YS5oYXNoKSkge1xuICAgIG1ldGEgPSB7IC4uLm1ldGEsIC4uLmFzc2V0TWFwT3ZlcnJpZGVbbWV0YS5oYXNoXSB9O1xuICB9XG5cbiAgLy8gVGhpcyBsb2dpYyBpcyBiYXNlZCBvbiB0aGF0IG9mIEFzc2V0U291cmNlUmVzb2x2ZXIsIHdpdGggYWRkaXRpb25hbCBzdXBwb3J0IGZvciBmaWxlIGhhc2hlcyBhbmRcbiAgLy8gZXhwbGljaXRseSBwcm92aWRlZCBVUklzXG4gIGNvbnN0IHNjYWxlID0gQXNzZXRTb3VyY2VSZXNvbHZlci5waWNrU2NhbGUobWV0YS5zY2FsZXMsIFBpeGVsUmF0aW8uZ2V0KCkpO1xuICBjb25zdCBpbmRleCA9IG1ldGEuc2NhbGVzLmZpbmRJbmRleCgocykgPT4gcyA9PT0gc2NhbGUpO1xuICBjb25zdCBoYXNoID0gbWV0YS5maWxlSGFzaGVzID8gbWV0YS5maWxlSGFzaGVzW2luZGV4XSB8fCBtZXRhLmZpbGVIYXNoZXNbMF0gOiBtZXRhLmhhc2g7XG5cbiAgLy8gQWxsb3cgYXNzZXQgcHJvY2Vzc29ycyB0byBkaXJlY3RseSBwcm92aWRlIHRoZSBVUkwgdG8gbG9hZFxuICBjb25zdCB1cmkgPSBtZXRhLmZpbGVVcmlzID8gbWV0YS5maWxlVXJpc1tpbmRleF0gfHwgbWV0YS5maWxlVXJpc1swXSA6IG1ldGEudXJpO1xuICBpZiAodXJpKSB7XG4gICAgcmV0dXJuIHsgdXJpOiByZXNvbHZlVXJpKHVyaSksIGhhc2ggfTtcbiAgfVxuXG4gIC8vIENoZWNrIGlmIHRoZSBhc3NldFVybCB3YXMgb3ZlcnJpZGRlbiBpbiB0aGUgbWFuaWZlc3RcbiAgY29uc3QgYXNzZXRVcmxPdmVycmlkZSA9IGdldE1hbmlmZXN0KCkuYXNzZXRVcmxPdmVycmlkZTtcbiAgaWYgKGFzc2V0VXJsT3ZlcnJpZGUpIHtcbiAgICBjb25zdCB1cmkgPSBwYXRoLmpvaW4oYXNzZXRVcmxPdmVycmlkZSwgaGFzaCk7XG4gICAgcmV0dXJuIHsgdXJpOiByZXNvbHZlVXJpKHVyaSksIGhhc2ggfTtcbiAgfVxuXG4gIGNvbnN0IGZpbGVTY2FsZSA9IHNjYWxlID09PSAxID8gJycgOiBgQCR7c2NhbGV9eGA7XG4gIGNvbnN0IGZpbGVFeHRlbnNpb24gPSBtZXRhLnR5cGUgPyBgLiR7ZW5jb2RlVVJJQ29tcG9uZW50KG1ldGEudHlwZSl9YCA6ICcnO1xuICBjb25zdCBzdWZmaXggPSBgLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFxuICAgIG1ldGEubmFtZVxuICApfSR7ZmlsZVNjYWxlfSR7ZmlsZUV4dGVuc2lvbn0/cGxhdGZvcm09JHtlbmNvZGVVUklDb21wb25lbnQoXG4gICAgUGxhdGZvcm0uT1NcbiAgKX0maGFzaD0ke2VuY29kZVVSSUNvbXBvbmVudChtZXRhLmhhc2gpfWA7XG5cbiAgLy8gRm9yIGFzc2V0cyB3aXRoIGEgc3BlY2lmaWVkIGFic29sdXRlIFVSTCwgd2UgdXNlIHRoZSBleGlzdGluZyBvcmlnaW4gaW5zdGVhZCBvZiBwcmVwZW5kaW5nIHRoZVxuICAvLyBkZXZlbG9wbWVudCBzZXJ2ZXIgb3IgcHJvZHVjdGlvbiBDRE4gVVJMIG9yaWdpblxuICBpZiAoL15odHRwcz86XFwvXFwvLy50ZXN0KG1ldGEuaHR0cFNlcnZlckxvY2F0aW9uKSkge1xuICAgIGNvbnN0IHVyaSA9IG1ldGEuaHR0cFNlcnZlckxvY2F0aW9uICsgc3VmZml4O1xuICAgIHJldHVybiB7IHVyaSwgaGFzaCB9O1xuICB9XG5cbiAgLy8gRm9yIGFzc2V0cyBkdXJpbmcgZGV2ZWxvcG1lbnQgdXNpbmcgbWFuaWZlc3QyLCB3ZSB1c2UgdGhlIGRldmVsb3BtZW50IHNlcnZlcidzIFVSTCBvcmlnaW5cbiAgY29uc3QgbWFuaWZlc3QyID0gZ2V0TWFuaWZlc3QyKCk7XG5cbiAgaWYgKG1hbmlmZXN0Mj8uZXh0cmE/LmV4cG9Hbz8uZGV2ZWxvcGVyKSB7XG4gICAgY29uc3QgYmFzZVVybCA9IG5ldyBVUkwoYGh0dHA6Ly8ke21hbmlmZXN0Mi5leHRyYS5leHBvR28uZGVidWdnZXJIb3N0fWApO1xuICAgIGJhc2VVcmwuc2V0KCdwYXRobmFtZScsIG1ldGEuaHR0cFNlcnZlckxvY2F0aW9uICsgc3VmZml4KTtcblxuICAgIHJldHVybiB7XG4gICAgICB1cmk6IGJhc2VVcmwuaHJlZixcbiAgICAgIGhhc2gsXG4gICAgfTtcbiAgfVxuXG4gIC8vIEZvciBhc3NldHMgZHVyaW5nIGRldmVsb3BtZW50LCB3ZSB1c2UgdGhlIGRldmVsb3BtZW50IHNlcnZlcidzIFVSTCBvcmlnaW5cbiAgaWYgKGdldE1hbmlmZXN0KCkuZGV2ZWxvcGVyKSB7XG4gICAgY29uc3QgYmFzZVVybCA9IG5ldyBVUkwoZ2V0TWFuaWZlc3QoKS5idW5kbGVVcmwpO1xuICAgIGJhc2VVcmwuc2V0KCdwYXRobmFtZScsIG1ldGEuaHR0cFNlcnZlckxvY2F0aW9uICsgc3VmZml4KTtcbiAgICByZXR1cm4geyB1cmk6IGJhc2VVcmwuaHJlZiwgaGFzaCB9O1xuICB9XG5cbiAgLy8gUHJvZHVjdGlvbiBDRE4gVVJJcyBhcmUgYmFzZWQgb24gZWFjaCBhc3NldCBmaWxlIGhhc2hcbiAgcmV0dXJuIHtcbiAgICB1cmk6IGBodHRwczovL2NsYXNzaWMtYXNzZXRzLmVhc2Nkbi5uZXQvfmFzc2V0cy8ke2VuY29kZVVSSUNvbXBvbmVudChoYXNoKX1gLFxuICAgIGhhc2gsXG4gIH07XG59XG5cbi8qKlxuICogUmVzb2x2ZXMgdGhlIGdpdmVuIFVSSSB0byBhbiBhYnNvbHV0ZSBVUkkuIElmIHRoZSBnaXZlbiBVUkkgaXMgYWxyZWFkeSBhbiBhYnNvbHV0ZSBVUkksIGl0IGlzXG4gKiBzaW1wbHkgcmV0dXJuZWQuIE90aGVyd2lzZSwgaWYgaXQgaXMgYSByZWxhdGl2ZSBVUkksIGl0IGlzIHJlc29sdmVkIHJlbGF0aXZlIHRvIHRoZSBtYW5pZmVzdCdzXG4gKiBiYXNlIFVSSS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVVcmkodXJpOiBzdHJpbmcpOiBzdHJpbmcge1xuICBpZiAoIW1hbmlmZXN0QmFzZVVybCkge1xuICAgIHJldHVybiB1cmk7XG4gIH1cblxuICBjb25zdCB7IHByb3RvY29sIH0gPSBuZXcgVVJMKHVyaSk7XG4gIGlmIChwcm90b2NvbCAhPT0gJycpIHtcbiAgICByZXR1cm4gdXJpO1xuICB9XG5cbiAgY29uc3QgYmFzZVVybCA9IG5ldyBVUkwobWFuaWZlc3RCYXNlVXJsKTtcbiAgY29uc3QgcmVzb2x2ZWRQYXRoID0gdXJpLnN0YXJ0c1dpdGgoJy8nKSA/IHVyaSA6IHBhdGguam9pbihiYXNlVXJsLnBhdGhuYW1lLCB1cmkpO1xuICBiYXNlVXJsLnNldCgncGF0aG5hbWUnLCByZXNvbHZlZFBhdGgpO1xuICByZXR1cm4gYmFzZVVybC5ocmVmO1xufVxuIl19